<header class="app-topbar">
  <div class="page-container topbar-menu">
    <div class="d-flex align-items-center gap-2">
      <app-logo />

      <button class="sidenav-toggle-button px-2" (click)="toggleMobileMenu()">
        <i class="ti ti-menu-deep fs-24"></i>
      </button>

      <button
        (click)="toggleMobileMenu()"
        class="topnav-toggle-button px-2"
        data-bs-toggle="collapse"
        data-bs-target="#topnav-menu-content"
      >
        <i class="ti ti-menu-deep fs-22"></i>
      </button>
    </div>

    <div class="d-flex align-items-center gap-2">
      <div class="topbar-item d-flex d-xl-none">
        <button
          (click)="open(content)"
          class="topbar-link"
          data-bs-toggle="modal"
          data-bs-target="#searchModal"
          type="button"
        >
          <i class="ti ti-search fs-22"></i>
        </button>
      </div>

      <div class="topbar-item">
        <div ngbDropdown>
          <button
            ngbDropdownToggle
            class="topbar-link arrow-none"
            data-bs-toggle="dropdown"
            data-bs-offset="0,25"
            type="button"
            aria-haspopup="false"
            aria-expanded="false"
          >
            <img
              [src]="
                'assets/images/flags/' +
                (languageToFlagMap[translate.currentLang] || 'us') +
                '.svg'
              "
              alt="language-flag"
              class="w-100 rounded"
              height="18"
            />
          </button>

          <div ngbDropdownMenu class="dropdown-menu-end">
            @for (item of languageList; track $index) {
              <a
                ngbDropdownItem
                href="javascript:void(0);"
                (click)="changeLanguage(item.code)"
              >
                <img
                  [src]="item.flag"
                  alt="flag"
                  class="me-1 rounded"
                  height="18"
                />
                <span class="align-middle">{{ item.name }}</span>
              </a>
            }
          </div>
        </div>
      </div>

      <div class="topbar-item d-none d-sm-flex">
        <button
          class="topbar-link"
          (click)="changeTheme()"
          id="light-dark-mode"
          type="button"
        >
          @if (color === 'light') {
            <i class="ti ti-moon fs-22"></i>
          } @else {
            <i class="ti ti-sun fs-22"></i>
          }
        </button>
      </div>

      <div class="topbar-item nav-user">
        <div ngbDropdown>
          <a
            ngbDropdownToggle
            class="topbar-link drop-arrow-none px-2"
            data-bs-toggle="dropdown"
            data-bs-offset="0,19"
            type="button"
            aria-haspopup="false"
            aria-expanded="false"
          >
            <img
              [src]="userImage || 'assets/images/default-avatar.png'"
              width="32"
              class="rounded-circle me-lg-2 d-flex"
              alt="user-image"
            />
            <span class="d-lg-flex flex-column gap-1 d-none">
              <h5 class="my-0">{{ userProfile?.username }}</h5>
              <h6 class="my-0 fw-normal">
                {{ userProfile?.roleId?.roleName }}
              </h6>
            </span>
            <i
              class="ti ti-chevron-down d-none d-lg-block align-middle ms-2"
            ></i>
          </a>
          <div ngbDropdownMenu class="dropdown-menu-end">
            <div class="dropdown-header noti-title">
              <h6 class="text-overflow m-0">
                {{ 'WORDS.WELCOME' | translate }} {{ userProfile?.username }}!
              </h6>
            </div>

            <a href="/profile" ngbDropdownItem>
              <i class="ti ti-user-hexagon me-1 fs-17 align-middle"></i>
              <span class="align-middle">{{
                'TOPBAR.MY_ACCOUNT' | translate
              }}</span>
            </a>

            <div class="dropdown-divider"></div>

            <a href="/auth/lock-screen" ngbDropdownItem>
              <i class="ti ti-lock-square-rounded me-1 fs-17 align-middle"></i>
              <span class="align-middle">Lock Screen</span>
            </a>

            <a
              (click)="logout()"
              class="cursor-pointer dropdown-item active fw-semibold text-danger"
            >
              <i class="ti ti-logout me-1 fs-17 align-middle"></i>
              <span class="align-middle">{{
                'TOPBAR.SIGN_OUT' | translate
              }}</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<ng-template #content let-modal>
  <div class="card mb-0 w-100">
    <div class="px-3 py-2 d-flex flex-row align-items-center" id="top-search">
      <i class="ti ti-search fs-22"></i>
      <input
        type="search"
        class="form-control border-0"
        id="search-modal-input"
        [placeholder]="'TOPBAR.SEARCH' | translate"
      />
      <button
        type="button"
        class="btn p-0"
        data-bs-dismiss="modal"
        aria-label="Close"
      >
        [esc]
      </button>
    </div>
  </div>
</ng-template>
