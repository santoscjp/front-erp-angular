<div class="card shadow-sm rounded">
  <div class="card-body">
    <h5 class="fw-semibold mb-1">
      {{ 'PROFILE.SECURITY.CHANGE_PASSWORD.TITLE' | translate }}
    </h5>
    <p class="text-muted mb-3 fs-14">
      {{ 'PROFILE.SECURITY.CHANGE_PASSWORD.SUBTITLE' | translate }}
    </p>

    @if (!isLocalUser) {
      <div class="alert alert-info d-flex align-items-center gap-2 mb-0">
        <i class="ti ti-info-circle fs-18 flex-shrink-0"></i>
        <span>{{ 'PROFILE.SECURITY.CHANGE_PASSWORD.SSO_NOTICE' | translate }}</span>
      </div>
    } @else {
      <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
        <div class="row g-3">

          <!-- Contrase침a actual -->
          <div class="col-md-12">
            <label class="form-label text-muted">
              {{ 'PROFILE.FIELDS.ACTUAL_PASSWORD' | translate }}
            </label>
            <div class="input-group">
              <input
                class="form-control"
                [type]="showCurrentPassword ? 'text' : 'password'"
                formControlName="currentPassword"
                [class.is-invalid]="
                  passwordForm.get('currentPassword')?.invalid &&
                  passwordForm.get('currentPassword')?.touched
                "
              />
              <button
                class="btn btn-outline-secondary"
                type="button"
                (click)="showCurrentPassword = !showCurrentPassword"
              >
                <i
                  class="ti"
                  [class.ti-eye]="!showCurrentPassword"
                  [class.ti-eye-off]="showCurrentPassword"
                ></i>
              </button>
              @if (
                passwordForm.get('currentPassword')?.invalid &&
                passwordForm.get('currentPassword')?.touched
              ) {
                <div class="invalid-feedback">
                  {{ 'PROFILE.SECURITY.CHANGE_PASSWORD.REQUIRED' | translate }}
                </div>
              }
            </div>
          </div>

          <!-- Nueva contrase침a -->
          <div class="col-md-6">
            <label class="form-label text-muted">
              {{ 'PROFILE.FIELDS.NEW_PASSWORD' | translate }}
            </label>
            <div class="input-group">
              <input
                class="form-control"
                [type]="showNewPassword ? 'text' : 'password'"
                formControlName="newPassword"
                [class.is-invalid]="
                  newPasswordControl.invalid && newPasswordControl.touched
                "
              />
              <button
                class="btn btn-outline-secondary"
                type="button"
                (click)="showNewPassword = !showNewPassword"
              >
                <i
                  class="ti"
                  [class.ti-eye]="!showNewPassword"
                  [class.ti-eye-off]="showNewPassword"
                ></i>
              </button>
              @if (newPasswordControl.touched) {
                @if (newPasswordControl.hasError('required')) {
                  <div class="invalid-feedback">
                    {{ 'PROFILE.SECURITY.CHANGE_PASSWORD.REQUIRED' | translate }}
                  </div>
                } @else if (newPasswordControl.hasError('minlength')) {
                  <div class="invalid-feedback">
                    {{ 'PROFILE.SECURITY.CHANGE_PASSWORD.MIN_LENGTH' | translate }}
                  </div>
                }
              }
            </div>
          </div>

          <!-- Confirmar contrase침a -->
          <div class="col-md-6">
            <label class="form-label text-muted">
              {{ 'PROFILE.FIELDS.CONFIRM_PASSWORD' | translate }}
            </label>
            <div class="input-group">
              <input
                class="form-control"
                [type]="showConfirmPassword ? 'text' : 'password'"
                formControlName="confirmPassword"
                [class.is-invalid]="
                  (confirmPasswordControl.invalid &&
                    confirmPasswordControl.touched) ||
                  hasPasswordMismatch
                "
              />
              <button
                class="btn btn-outline-secondary"
                type="button"
                (click)="showConfirmPassword = !showConfirmPassword"
              >
                <i
                  class="ti"
                  [class.ti-eye]="!showConfirmPassword"
                  [class.ti-eye-off]="showConfirmPassword"
                ></i>
              </button>
              @if (hasPasswordMismatch) {
                <div class="invalid-feedback">
                  {{ 'PROFILE.SECURITY.CHANGE_PASSWORD.MISMATCH' | translate }}
                </div>
              } @else if (
                confirmPasswordControl.hasError('required') &&
                confirmPasswordControl.touched
              ) {
                <div class="invalid-feedback">
                  {{ 'PROFILE.SECURITY.CHANGE_PASSWORD.REQUIRED' | translate }}
                </div>
              }
            </div>
          </div>

          <!-- Acci칩n -->
          <div class="col-12 d-flex justify-content-end">
            <button
              type="submit"
              class="btn btn-primary rounded-pill"
              [disabled]="passwordForm.invalid || isLoading"
            >
              @if (isLoading) {
                <span
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                ></span>
              } @else {
                <i class="ti ti-lock-check me-1"></i>
              }
              {{ 'PROFILE.BUTTONS.UPDATE_PASSWORD' | translate }}
            </button>
          </div>
        </div>
      </form>
    }
  </div>
</div>
