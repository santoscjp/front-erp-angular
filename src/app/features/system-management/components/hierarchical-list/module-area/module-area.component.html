<div class="chat-content card rounded-0 shadow-none mb-0">
  <div class="card-body py-2 px-3 border-bottom">
    <div class="d-flex align-items-center gap-2 py-1">
      <div class="flex-grow-1">
        <p class="mb-0 text-muted">
          {{ 'ROLES_AND_PERMISSIONS.MODULE.LIST_MODULES' | translate }}
        </p>
      </div>
      <div ngbDropdown class="lh-1">
        <a
          ngbDropdownToggle
          class="dropdown-toggle cursor-pointer drop-arrow-none card-drop"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          <iconify-icon
            icon="solar:settings-outline"
            class="align-middle"
          ></iconify-icon>
        </a>
        <div ngbDropdownMenu class="dropdown-menu-end">
          <a href="javascript:void(0);" ngbDropdownItem (click)="openModal()">
            <i class="ti ti-shield-plus me-1 fs-17 align-middle"></i>
            <span class="align-middle">{{
              'ROLES_AND_PERMISSIONS.MODULE.NEW_MODULE' | translate
            }}</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="px-3 py-2">
    <div class="app-search py-1">
      <input
        type="text"
        class="form-control border-light bg-light bg-opacity-50 rounded-2"
        placeholder="{{
          'ROLES_AND_PERMISSIONS.MODULE.SEARCH_MODULES' | translate
        }}"
        [(ngModel)]="searchTerm"
        (input)="onSearchInput()"
        (keyup.enter)="searchModules()"
      />
      <i class="app-search-icon ti ti-search text-muted fs-16"></i>
    </div>
  </div>

  <div class="d-flex flex-column overflow-auto scrollbar">
    @let modules = modules$ | async;
    <ngx-simplebar
      class="users-list position-relative list-scroll"
      data-simplebar
    >
      @if (isLoading) {
        <div class="d-flex justify-content-center">
          <div class="spinner-border" role="status"></div>
        </div>
      } @else if (!isLoading) {
        @for (item of modules; track $index) {
          <div
            class="d-flex gap-2 py-1"
            [ngClass]="{
              'selected-module': item._id === selectedModuleId,
              'disabled-module': !item.isActive,
            }"
            (click)="item.isActive && selectModule(item._id)"
          >
            <a
              href="javascript:void(0);"
              class="text-body w-100 d-block"
              [class.pointer-events-none]="
                !item.isActiveForRole || !item.isActive
              "
            >
              <div class="chat-users">
                <div
                  class="flex-grow-1 overflow-hidden"
                  [ngClass]="{ 'text-muted opacity-50': !item.isActive }"
                  ngbTooltip="{{
                    !item.isActive
                      ? ('ROLES_AND_PERMISSIONS.MODULE.ACTIVATE_DEACTIVATE.MODULE_DEACTIVATE'
                        | translate)
                      : ''
                  }}"
                >
                  <h5 class="mt-0 mb-0 fs-13">{{ item.moduleName }}</h5>
                </div>
                <div class="d-flex gap-1 text-muted">
                  <i
                    *ngIf="item.isActive"
                    class="ti ti-pencil fs-16"
                    ngbTooltip="{{
                      'ROLES_AND_PERMISSIONS.MODULE.EDIT_MODULE' | translate
                    }}"
                    (click)="openEditModal(item._id, $event)"
                  >
                  </i>
                  <i
                    class="ti ti-shield-off fs-16 text-danger"
                    (click)="toggleModuleForRole(item._id)"
                    ngbTooltip="{{
                      'ROLES_AND_PERMISSIONS.MODULE.ACTIVATE_DEACTIVATE.DEACTIVATE_ALL_PERMISSIONS'
                        | translate
                    }}"
                  >
                  </i>
                  <i
                    class="ti ti-plus fs-16 text-danger"
                    (click)="openModalPermission(item._id, $event)"
                    ngbTooltip="{{
                      'ROLES_AND_PERMISSIONS.PERMISSION.NEW_PERMISSION'
                        | translate
                    }}"
                  ></i>
                </div>
              </div>
            </a>
          </div>
        } @empty {
          <div class="d-flex gap-2 py-1">
            <a href="javascript:void(0);" class="text-body w-100 d-block">
              <div class="chat-users">
                <div class="flex-grow-1 overflow-hidden">
                  <h5 class="mt-0 mb-0 fs-13">
                    {{
                      'ROLES_AND_PERMISSIONS.MODULE.NO_MODULES_FOUND'
                        | translate
                    }}
                  </h5>
                </div>
              </div>
            </a>
          </div>
        }
      }
    </ngx-simplebar>
  </div>
</div>
